@model List<QuestionViewModel>

@{
    ViewData["Title"] = "Feedback";
}


<form>
    @{
        int ques = 1;
        foreach (var data in Model)
        {
            <div class="form-group">
                <label>@data.Question <span class="text-danger">*</span></label>
                <textarea class="form-control answers ans-@ques" rows="3" required></textarea>
            </div>
            ques++;
        }
    }

    <button type="button" class="btn btn-primary mt-3" id="btnSubmit">Submit</button>
</form>

@section Scripts{
    <script>
        function validate() {
            $('.red').remove();
            var isvalid = true;
            var inputFields = $('.answers');
            for (var i = 0; i < inputFields.length; i++) {
                if ($(inputFields[i]).prop('required') && !$(inputFields[i]).val()) {
                    var field = $(inputFields[i]).attr('field');
                    $(inputFields[i]).after('<div class="red text-danger">This field is required</div>');
                    isvalid = false;
                } else {
                    $(inputFields[i]).next('div.red').remove();
                }
            }
            return isvalid;
        }
        $(document).ready(function () {
            $('.answers').on('blur', function (e) {
                validate();
            });

            $('#btnSubmit').on('click', function (e) {
                if (validate()) {
                    $.ajax({
                        url: "/Home/SaveFeedback",
                        type: "POST",
                        data: postdata,
                        success: function (data, textStatus, jqXHR) {
                            uploadFiles(data, function () {
                                Swal.fire({
                                    title: 'Success',
                                    text: "Successfully saved",
                                    icon: 'success',
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Ok'
                                }).then((result) => {
                                    location.reload();
                                });
                            });
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR);
                            console.log(textStatus);
                            console.log(errorThrown);

                            Swal.fire({
                                title: 'Error!',
                                text: errorThrown,
                                icon: 'error',
                                confirmButtonText: 'Ok'
                            });

                            $('.submitBtn').prop('disabled', false);
                        }
                    });
                }
            });
        });
    </script>
}